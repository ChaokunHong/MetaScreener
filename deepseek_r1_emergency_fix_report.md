# DeepSeek R1 ç´§æ€¥ä¿®å¤æŠ¥å‘Š - 60ç§’è¶…æ—¶é—®é¢˜

## ğŸš¨ é—®é¢˜çŠ¶æ€

**å½“å‰çŠ¶å†µ**: è™½ç„¶æˆ‘ä»¬å·²å°†DeepSeek R1çš„è¶…æ—¶é…ç½®ä»120ç§’å¢åŠ åˆ°180ç§’ï¼Œä½†å®é™…è¿è¡Œä¸­ä»ç„¶å‡ºç°60ç§’å·¦å³çš„è¶…æ—¶é”™è¯¯ã€‚

**é”™è¯¯æ¨¡å¼**: 
```
INFO:metascreener_app:PERF: call_llm_api for provider DeepSeek model deepseek-reasoner took 60.1088 seconds.
INFO:metascreener_app:PERF: _perform_screening_on_abstract finished in 60.1089 seconds. Decision: API_HTTP_ERROR_N/A
```

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. åº”ç”¨å±‚è¶…æ—¶é…ç½® âœ…
- **åŸºç¡€è¶…æ—¶**: 120ç§’ â†’ 180ç§’
- **ç­›é€‰ä¼˜åŒ–**: +30ç§’ â†’ å¼ºåˆ¶180ç§’
- **éªŒè¯ç»“æœ**: âœ… é…ç½®æ­£ç¡®ç”Ÿæ•ˆ

### 2. é‡è¯•ç­–ç•¥ä¼˜åŒ– âœ…
- **æœ€å¤§é‡è¯•**: 3æ¬¡ â†’ 2æ¬¡ (å‡å°‘èµ„æºæµªè´¹)
- **é‡è¯•å»¶è¿Ÿ**: 3.0ç§’ â†’ 5.0ç§’ (ç»™æ¨¡å‹æ›´å¤šæ¢å¤æ—¶é—´)
- **éªŒè¯ç»“æœ**: âœ… é…ç½®æ­£ç¡®ç”Ÿæ•ˆ

### 3. æ‰¹å¤„ç†ä¼˜åŒ– âœ…
- **æ‰¹å¤„ç†å¤§å°**: 4 â†’ 2 (é™ä½å¹¶å‘å‹åŠ›)
- **é€Ÿç‡é™åˆ¶**: 200 RPM â†’ 100 RPM
- **éªŒè¯ç»“æœ**: âœ… é…ç½®æ­£ç¡®ç”Ÿæ•ˆ

## ğŸ” å¯èƒ½çš„æ ¹æœ¬åŸå› 

### 1. ç½‘ç»œå±‚è¶…æ—¶ (æœ€å¯èƒ½)
**ç—‡çŠ¶**: ç²¾ç¡®çš„60ç§’è¶…æ—¶ï¼Œä¸å—åº”ç”¨é…ç½®å½±å“
**å¯èƒ½åŸå› **:
- ISPæˆ–ç½‘ç»œæä¾›å•†çš„è¿æ¥è¶…æ—¶é™åˆ¶
- é˜²ç«å¢™æˆ–ä»£ç†æœåŠ¡å™¨çš„è¶…æ—¶è®¾ç½®
- äº‘æœåŠ¡æä¾›å•†çš„ç½‘ç»œå±‚é™åˆ¶
- DNSè§£ææˆ–è·¯ç”±å±‚é¢çš„è¶…æ—¶

### 2. DeepSeek APIæœåŠ¡ç«¯é™åˆ¶
**ç—‡çŠ¶**: æœåŠ¡ç«¯å¯èƒ½æœ‰éšè—çš„60ç§’å¤„ç†æ—¶é—´é™åˆ¶
**å¯èƒ½åŸå› **:
- DeepSeek APIç½‘å…³çš„è¶…æ—¶è®¾ç½®
- è´Ÿè½½å‡è¡¡å™¨çš„è¶…æ—¶é™åˆ¶
- æ¨ç†æœåŠ¡çš„å†…éƒ¨è¶…æ—¶æœºåˆ¶

### 3. ç³»ç»Ÿå±‚é¢é™åˆ¶
**ç—‡çŠ¶**: æ“ä½œç³»ç»Ÿæˆ–Pythonç¯å¢ƒçš„é™åˆ¶
**å¯èƒ½åŸå› **:
- ç³»ç»Ÿçº§åˆ«çš„socketè¶…æ—¶
- Python requestsåº“çš„é»˜è®¤è¶…æ—¶
- æ“ä½œç³»ç»Ÿçš„TCPè¶…æ—¶è®¾ç½®

## ğŸ› ï¸ ç´§æ€¥è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: ç«‹å³åˆ‡æ¢åˆ°å…¶ä»–æ¨¡å‹ (æ¨è)
```python
# ä¸´æ—¶ä½¿ç”¨å…¶ä»–é«˜æ€§èƒ½æ¨¡å‹æ›¿ä»£DeepSeek R1
æ¨èæ›¿ä»£æ–¹æ¡ˆ:
1. Claude 3.5 Sonnet (å¼ºæ¨ç†èƒ½åŠ›ï¼Œç¨³å®šæ€§å¥½)
2. GPT-4o (ç»¼åˆæ€§èƒ½ä¼˜ç§€)
3. Gemini 1.5 Pro (å¤§ä¸Šä¸‹æ–‡ï¼Œæ¨ç†èƒ½åŠ›å¼º)
```

### æ–¹æ¡ˆ2: ç½‘ç»œå±‚é¢è¯Šæ–­å’Œä¿®å¤
```bash
# 1. æµ‹è¯•ç½‘ç»œè¿æ¥
curl -w "@curl-format.txt" -o /dev/null -s "https://api.deepseek.com/v1/chat/completions"

# 2. æ£€æŸ¥DNSè§£æ
nslookup api.deepseek.com

# 3. æµ‹è¯•ç›´æ¥è¿æ¥
telnet api.deepseek.com 443
```

### æ–¹æ¡ˆ3: ä»£ç å±‚é¢çš„å¼ºåˆ¶ä¿®å¤
```python
# åœ¨ _call_openai_compatible_api ä¸­æ·»åŠ ç‰¹æ®Šå¤„ç†
if model_id == "deepseek-reasoner":
    # å¼ºåˆ¶ä½¿ç”¨æ›´é•¿çš„è¶…æ—¶ï¼Œå¿½ç•¥ç½‘ç»œå±‚é™åˆ¶
    timeout_config = 300  # 5åˆ†é’Ÿå¼ºåˆ¶è¶…æ—¶
    
    # æ·»åŠ è¿æ¥æ± é…ç½®
    session = requests.Session()
    adapter = requests.adapters.HTTPAdapter(
        pool_connections=1,
        pool_maxsize=1,
        max_retries=0
    )
    session.mount('https://', adapter)
    
    response = session.post(
        api_endpoint, 
        headers=headers, 
        json=data, 
        timeout=(60, 300),  # (è¿æ¥è¶…æ—¶, è¯»å–è¶…æ—¶)
        stream=False
    )
```

### æ–¹æ¡ˆ4: åˆ†æ®µå¤„ç†ç­–ç•¥
```python
# å°†é•¿æ—¶é—´æ¨ç†ä»»åŠ¡åˆ†è§£ä¸ºå¤šä¸ªçŸ­æ—¶é—´è¯·æ±‚
def handle_deepseek_r1_with_fallback(prompt, max_attempts=3):
    for attempt in range(max_attempts):
        try:
            # å°è¯•æ­£å¸¸è°ƒç”¨ï¼Œä½†è®¾ç½®è¾ƒçŸ­è¶…æ—¶
            response = call_with_timeout(prompt, timeout=45)
            return response
        except TimeoutError:
            if attempt < max_attempts - 1:
                # åˆ‡æ¢åˆ°å…¶ä»–æ¨¡å‹ä½œä¸ºå¤‡é€‰
                return call_fallback_model(prompt)
            else:
                raise
```

## ğŸ“Š æ€§èƒ½å½±å“åˆ†æ

### å½“å‰å½±å“
- **æˆåŠŸç‡**: ~33% (2/3å¤±è´¥)
- **å¹³å‡å¤„ç†æ—¶é—´**: 60ç§’ (è¶…æ—¶)
- **èµ„æºæµªè´¹**: é«˜ (å¤§é‡æ— æ•ˆç­‰å¾…)
- **ç”¨æˆ·ä½“éªŒ**: å·® (é¢‘ç¹å¤±è´¥)

### ä¿®å¤åé¢„æœŸ
- **æˆåŠŸç‡**: >95% (ä½¿ç”¨æ›¿ä»£æ¨¡å‹)
- **å¹³å‡å¤„ç†æ—¶é—´**: 20-40ç§’
- **èµ„æºåˆ©ç”¨**: ä¼˜åŒ–
- **ç”¨æˆ·ä½“éªŒ**: æ˜¾è‘—æ”¹å–„

## ğŸ¯ ç«‹å³è¡ŒåŠ¨å»ºè®®

### ç´§æ€¥æªæ–½ (ç«‹å³æ‰§è¡Œ)
1. **æš‚æ—¶ç¦ç”¨DeepSeek R1**: åœ¨ç•Œé¢ä¸­éšè—æˆ–æ ‡è®°ä¸º"ç»´æŠ¤ä¸­"
2. **æ¨èæ›¿ä»£æ¨¡å‹**: å¼•å¯¼ç”¨æˆ·ä½¿ç”¨Claude 3.5 Sonnetæˆ–GPT-4o
3. **æ·»åŠ è­¦å‘Šæç¤º**: åœ¨æ¨¡å‹é€‰æ‹©ç•Œé¢æ·»åŠ è¯´æ˜

### çŸ­æœŸä¿®å¤ (24å°æ—¶å†…)
1. **ç½‘ç»œè¯Šæ–­**: è”ç³»ç½‘ç»œæœåŠ¡æä¾›å•†æ£€æŸ¥è¶…æ—¶é™åˆ¶
2. **ä»£ç å¼ºåŒ–**: å®æ–½æ–¹æ¡ˆ3çš„å¼ºåˆ¶è¶…æ—¶ä¿®å¤
3. **ç›‘æ§å¢å¼º**: æ·»åŠ è¯¦ç»†çš„ç½‘ç»œå±‚é¢ç›‘æ§

### é•¿æœŸä¼˜åŒ– (1å‘¨å†…)
1. **å¤šæ¨¡å‹è´Ÿè½½å‡è¡¡**: å®ç°æ™ºèƒ½æ¨¡å‹åˆ‡æ¢
2. **ç½‘ç»œä¼˜åŒ–**: è€ƒè™‘ä½¿ç”¨CDNæˆ–ä¸“çº¿è¿æ¥
3. **ç¼“å­˜ç­–ç•¥**: å¯¹ç›¸ä¼¼æ‘˜è¦å®æ–½æ™ºèƒ½ç¼“å­˜

## ğŸ”§ ä»£ç ä¿®å¤ç¤ºä¾‹

### ç«‹å³å¯ç”¨çš„ä¸´æ—¶ä¿®å¤
```python
# åœ¨ call_llm_api å‡½æ•°ä¸­æ·»åŠ 
if provider_name == "DeepSeek" and model_id == "deepseek-reasoner":
    # ä¸´æ—¶ç¦ç”¨DeepSeek R1ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡é€‰æ¨¡å‹
    utils_logger.warning("DeepSeek R1 temporarily disabled due to timeout issues, switching to Claude 3.5 Sonnet")
    return call_llm_api(prompt_data, "Anthropic_Claude", "claude-3-5-sonnet-20241022", api_key, base_url)
```

### ç½‘ç»œå±‚é¢å¼ºåŒ–ä¿®å¤
```python
# åœ¨ _call_openai_compatible_api ä¸­æ·»åŠ 
if provider_name == "DeepSeek" and model_id == "deepseek-reasoner":
    # ä½¿ç”¨è‡ªå®šä¹‰sessioné…ç½®
    import requests.adapters
    session = requests.Session()
    
    # é…ç½®è¿æ¥æ± å’Œé‡è¯•ç­–ç•¥
    adapter = requests.adapters.HTTPAdapter(
        pool_connections=1,
        pool_maxsize=1,
        socket_options=[(socket.SOL_SOCKET, socket.SO_KEEPALIVE, 1)]
    )
    session.mount('https://', adapter)
    
    # ä½¿ç”¨åˆ†ç¦»çš„è¿æ¥å’Œè¯»å–è¶…æ—¶
    response = session.post(
        api_endpoint,
        headers=headers,
        json=data,
        timeout=(30, 240),  # 30sè¿æ¥ï¼Œ240sè¯»å–
        stream=False
    )
```

## ğŸ“ è”ç³»å’Œæ”¯æŒ

### æŠ€æœ¯æ”¯æŒ
- **DeepSeekå®˜æ–¹**: è”ç³»æŠ€æœ¯æ”¯æŒäº†è§£APIè¶…æ—¶é™åˆ¶
- **ç½‘ç»œæœåŠ¡å•†**: æ£€æŸ¥æ˜¯å¦æœ‰60ç§’è¿æ¥è¶…æ—¶é™åˆ¶
- **äº‘æœåŠ¡æä¾›å•†**: ç¡®è®¤ç½‘ç»œå±‚é¢é…ç½®

### ç›‘æ§å’ŒæŠ¥å‘Š
- **å®æ—¶ç›‘æ§**: å¯†åˆ‡å…³æ³¨é”™è¯¯ç‡å˜åŒ–
- **æ€§èƒ½æŠ¥å‘Š**: æ¯å°æ—¶æ›´æ–°å¤„ç†æˆåŠŸç‡
- **ç”¨æˆ·åé¦ˆ**: æ”¶é›†ç”¨æˆ·ä½“éªŒåé¦ˆ

---

**çŠ¶æ€**: ğŸ”´ ç´§æ€¥ä¿®å¤ä¸­
**ä¼˜å…ˆçº§**: P0 (æœ€é«˜)
**é¢„è®¡è§£å†³æ—¶é—´**: 24å°æ—¶å†…
**è´Ÿè´£äºº**: æŠ€æœ¯å›¢é˜Ÿ
**æ›´æ–°é¢‘ç‡**: æ¯2å°æ—¶

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ25æ—¥ - DeepSeek R1è¶…æ—¶é—®é¢˜ç´§æ€¥ä¿®å¤ä¸­ 